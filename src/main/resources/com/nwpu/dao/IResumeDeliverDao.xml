<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nwpu.dao.IResumeDeliverDao">

    <resultMap id="resumeDeliverMap" type="resumeDeliver">
        <id property="id" column="id"></id>
        <result property="createTime" column="createTime"></result>
        <result property="jobId" column="jobId"></result>
        <result property="resumeId" column="resumeId"></result>
        <result property="status" column="status"></result>
    </resultMap>

    <resultMap id="deliverListMap" type="deliverListBean">
        <id property="deliverId" column="deliverId"></id>
        <result property="jobId" column="jobId"></result>
        <result property="companyName" column="companyName"></result>
        <result property="jobName" column="jobName"></result>
        <result property="createTime" column="createTime"></result>
        <result property="status" column="status"></result>
    </resultMap>

    <select id="findDeliverListByPage" resultMap="deliverListMap" parameterType="map">
            select r.id as deliverId, r.jobId, c.name as companyName, j.jobName, r.createTime, r.status
            from RESUMEDELIVER r, JOB j, COMPANY c
            where r.jobId = j.id
            and j.companyId = c.id
            and r.resumeId = #{resumeId}
            <if test="status!= null and status!= 3">
                and status = #{status}
            </if>

        limit #{start},#{size}
    </select>

    <select id="findAllByDeliverByStatus" resultType="int">
        select count(j.id)
        from RESUMEDELIVER r, JOB j, COMPANY c
        where r.jobId = j.id
        and j.companyId = c.id
        and r.resumeId = #{resumeId}
        <if test="status!= null and status != 3">
           and status = #{status}
        </if>
    </select>

    <select id="isDeliver" resultType="int" parameterType="Integer">
        select count(id)
        from RESUMEDELIVER
        where resumeId = #{resumeId}
        and jobId = #{jobId}
    </select>

    <insert id="saveDeliver" parameterType="resumeDeliver" keyProperty="id" useGeneratedKeys="true">
        insert into RESUMEDELIVER (createTime, jobId, resumeId, status)
        values(#{createTime}, #{jobId},#{resumeId},#{status})
    </insert>
</mapper>